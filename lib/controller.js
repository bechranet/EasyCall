var riepilogo_asporto,riepilogo_costo_asporto,riepilogo_domicilio,riepilogo_costo_domicilio,riepilogo_altavolo,riepilogo_costo_altavolo,riepilogo_prodotti,riepilogo_costo_prodotti,riepilogo_ombrellone,riepilogo_costo_ombrellone,riepilogo_costo_totale,riepilogo_delivery,riepilogo_costo_delivery,riepilogo_annullato,riepilogo_costo_annullato,is_status_in_consegna,is_status_in_arrivo,ll,rx,data_print_wifi;function OnStart(){app.PreventWifiSleep(),app.SetOrientation("Portrait"),app.PreventScreenLock(!0),app.PreventScreenLock(!0),app.EnableBackKey(!1),app.GetSpecialFolder("Firebase");var splash=app.CreateLayout("Linear","VCenter,FillXY");splash.SetBackColor("#ffffff");var img=app.CreateImage("Img/logas.png",1,-1);function goerror(o){app.ShowPopup("Error Connection!!"),1==confirm("Attenzione!! Connessione Internet assente \n  premere OK per uscire  \n  Annullare per Attendere")?app.Exit():(app.ShowProgress("Connessione DataCloud  in corso..Attendere Prego"),setTimeout("app.HideProgress()",7e3))}img.SetOnLongTouch(resetTab),splash.AddChild(img),app.AddLayout(splash);var firebaseConfig=JSON.parse(app.ReadFile("set.json"));function restart(){auth.onAuthStateChanged(OnAuth),db.ref(".info/connected").on("value",OnConnectionChange)}function Connect(){auth.signInWithEmailAndPassword(idAPP+"@cittacoupon.com",encryptedId).catch((function(o){}))}function CreateListeners(){auth.onAuthStateChanged(OnAuth),db.ref(".info/connected").on("value",OnConnectionChange)}function ConnectFFT(){auth.createUserWithEmailAndPassword(idAPP+"@cittacoupon.com",encryptedId).then(OnAuth).catch((o=>{"auth/email-already-in-use"==o.code?Connect():"auth/invalid-email"==o.code?console.log("Email address is invalid."):"auth/operation-not-allowed"==o.code?console.log("Error during sign up."):"auth/weak-password"==o.code?console.log("Password is not strong enough. Add additional characters including special characters and numbers."):console.log(o.code)}))}function OnAuth(user){user&&uid===user.uid||(db.ref("ordini_in_arrivo/"+uid).off(),eval(usercom)?(uid=auth.currentUser.uid,db.goOnline(),app.HideProgress(),app.RemoveLayout(splash),app.DestroyLayout(splash),db.ref("comm").once("value",(function(o){for(a in o=o.val())if("valore_punti"==a&&(valore_punti=o.valore_punti,valore_punti_ordini_tavolo=o.valore_punti_ordini_tavolo),o.version>versione_app){var t=app.CreateYesNoDialog("Attenzione!! Quest'APP ha bbisogno di un aggiornamento,vuoi procedere?");t.SetOnTouch((function(o){"Yes"==o?dwn():app.ShowPopup("Aggiornamento Rimandato")})),t.Show()}})),db.ref("config/"+uid).once("value",(function(o){for(a in null==(o=o.val())?(db.ref("config/"+uid).update(default_config),alert("E' stato eseguito un aggiornamento del MASTER-DataBase, per rendere le modifiche esecutive questa applicazione sarà riavviata!!"),app.Exit()):(upgradeStatus=db_init(o),"true"==upgradeStatus&&(alert("E' stato eseguito un aggiornamento del UPGRADE-DataBase, per rendere le modifiche esecutive questa applicazione sarà riavviata!!"),app.Exit())),o)if(db.ref("credito/"+uid).once("value",(function(o){for(as in null==(o=o.val())&&(db.ref("credito/"+uid).update(default_credito),alert("E' stato eseguito un aggiornamento del ADD-DataBase, per rendere le modifiche esecutive questa applicazione sarà riavviata!!"),app.Exit()),o)"punti"==as&&(creditoPunti=o.punti),"sms"==as&&(creditoSms=o.sms)})),datas[a]=o[a],"1_color_header"==a&&(app.SaveText("color_head",o["1_color_header"]),$("#color_banner_up").css("background-color",o["1_color_header"])),"3_color_footer"==a&&(app.SaveText("color_footer",o["3_color_footer"]),$("#footer").html(footer_in_arrivo),$("#footer").show(),$("#footer_color").css("background-color",o["3_color_footer"])),"4_on_button"==a&&app.SaveText("on_button",o["4_on_button"]),"5_off_button"==a&&app.SaveText("off_button",o["5_off_button"]),"6_icon_color"==a&&app.SaveText("icon_color",o["6_icon_color"]),"7_text_color"==a&&app.SaveText("text_color",o["7_text_color"]),"8_border_color"==a&&app.SaveText("boder_color",o["8_border_color"]),a,"2x_tipo_user"==a&&(tipo_user=o["2x_tipo_user"],"premium"==tipo_user?document.getElementById("punti_azienda").innerHTML="<strong>PREMIUM</strong>":document.getElementById("punti_azienda").innerHTML="<strong>"+creditoPunti+"</strong> Punti"),"0_start"==a&&(app.HideProgressBar(),$("#color_banner_up").show(),$("#xmain").show(),app.LoadScript("setting.js"),app.LoadScript("messaggi_notifica.js"),app.LoadScript("keystore.js"),app.LoadScript("notifiche.js"),aggiornami={api_id:idAPP,app_version:versione_app,online:moment().format("DD/MM/YYYY HH:mm")},db.ref("config/"+uid).update(aggiornami).then(OnSuccessSend).catch(OnFailedSend)),"00_debug"==a&&("false"==datas["00_debug"]?app.SetOnError(goerror):app.ShowPopup("Debug Mode")),"00_footer_button_tools"==a&&(footer_button_tools=o["00_footer_button_tools"],"true"==footer_button_tools&&(app.SetScreenMode("Full"),app.SetScreenMode("Game"))),"00_status"==a&&"false"==datas["00_status"]&&(alert("Dispositivo: "+idAPP+" non autorizzato!! \n contattare il nostro servizio tecnico \n per ulteriori dettagli. Grazie"),app.Exit()),"print_tipo_connessione"==a&&(print_tipo_connessione=o.print_tipo_connessione,console.log("print_tipo_connessione : "+print_tipo_connessione),"wifi"==print_tipo_connessione&&(net=app.CreateNetClient("TCP,Raw"),net.SetOnConnect(net_OnConnect))),"print_wifi_00"==a&&(print_0=datas.print_wifi_00.split(",")),"print_wifi_01"==a&&(print_1=datas.print_wifi_01.split(",")),"print_wifi_02"==a&&(print_2=datas.print_wifi_02.split(",")),"print_wifi_03"==a&&(print_3=datas.print_wifi_03.split(",")),"print_wifi_04"==a&&(print_4=datas.print_wifi_04.split(",")),"print_wifi_05"==a&&(print_5=datas.print_wifi_05.split(",")),"print_wifi_qta"==a&&(datas.print_wifi_qta<2?prt=1:prt=2),"webpage"==a)for(page in webpage=o[a],webpage)data_page[page]=webpage[page];test_conn()})),test_conn&&("Tablet"==dispositivo||(dispositivo="Unico"),db.ref("config/"+uid).update({tipo_dispositivo:dispositivo,tipo_dispositivo_height:height_hw,tipo_dispositivo_width:width_hw}),db.ref("credito").child(uid).on("value",(function(o){o=o.val();for(a in o)"punti"==a&&"premium"!=tipo_user&&(document.getElementById("punti_azienda").innerHTML="<strong>"+o.punti+"</strong> Punti",creditoPunti=o.punti),"sms"==a&&(creditoSms=o.sms)})),db.ref("rider/"+uidU+"/"+idAPPU+"/"+id_rider).once("value",(function(o){for(a in o=o.val())rider_data[a]=o[a]})),db.ref("ordini_annullato/"+uid).orderByChild("id_ordine").on("child_added",(function(o,t){for(a in o=o.val())if("id_ordine"==a){tipo=select_tipo("ordini_annullato",parseInt(o.ordine_tipo));var i="no";"false"==stsMua&&(i="yes"),"true"==stsMua&&("Master"==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes")),"yes"==i&&$("#rx_annullato").prepend('<tr id="'+o.id_ordine+'" onclick="dettaglio_storico(this.id,4)"><td><div class="col" style="padding-top: 0px;border-style: '+border_style+';margin-bottom: -20px;"><h4 style="color: rgb(0,123,255);border-style: none;border-color: rgba(1,164,225,0);text-align: center;"><button id="notyr-'+o.id_ordine+'"; class="btn btn-primary" type="button" style="font-size: 12px;color: rgb(1,1,1);background-color: rgb(255,255,255);border-width: 1px;border-color: rgb(7,7,7);box-shadow: 0px 0px 7px rgb(62,140,228);"><i class="fa fa-check" style="font-size: 12px;"></i>&nbsp;ID Ordine&nbsp;<strong>'+o.id_ordine+"&nbsp; </strong>del &nbsp;<strong>"+o.data_ordine+'</strong></button></h4><h4 class="text-body" style="font-size: 12px;text-align: center;">'+o.nome+" "+o.cognome+'</h4><p class="text-center" style="font-size: 12px;background-color: rgba(0,0,0,0);'+tipo.style_oia+'padding-left: 0px;padding-top: 0px;margin-bottom: 0px;margin-top: 0px;"><img width="'+iconpx+'" height=" '+iconpx+' " src='+tipo.tipo+'><strong>  ANNULLATO</strong></p><p style="font-size: 12px;margin-bottom: 0px;margin-top: 0px;text-align: center;padding-top: 0px;">Tot. Importo <strong>'+o.totale_ordine+"</strong>€</p></td></tr>")}})),db.ref("ordini_consegnato/"+uid).orderByChild("id_ordine").on("child_added",(function(o,t){for(a in o=o.val())if("id_ordine"==a){tipo=select_tipo("ordini_consegnato",parseInt(o.ordine_tipo));var i="no";"false"==stsMua&&(i="yes"),"true"==stsMua&&("Master"==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes")),"yes"==i&&$("#rx_consegnato").prepend('<tr id="'+o.id_ordine+'" onclick="dettaglio_storico(this.id,3)"><td><div class="col" style="padding-top: 0px;border-style: '+border_style+';margin-bottom: -20px;"><h4 style="color: rgb(0,123,255);border-style: none;border-color: rgba(1,164,225,0);text-align: center;"><button id="notyr-'+o.id_ordine+'"; class="btn btn-primary" type="button" style="font-size: 10px;color: rgb(1,1,1);background-color: rgb(255,255,255);border-width: 1px;border-color: rgb(7,7,7);box-shadow: 0px 0px 7px rgb(62,140,228);"><i class="fa fa-check" style="font-size: 12px;"></i>&nbsp;ID Ordine&nbsp;<strong>'+o.id_ordine+"&nbsp; </strong>del &nbsp;<strong>"+o.data_lavorazione+'</strong></button></h4><h4 class="text-body" style="font-size: 12px;text-align: center;">'+o.nome+" "+o.cognome+'</h4><p class="text-center" style="font-size: 12px;background-color: rgba(0,0,0,0);'+tipo.style_oia+'padding-left: 0px;padding-top: 0px;margin-bottom: 0px;margin-top: 0px;"><img width="'+iconpx+'" height=" '+iconpx+' "  src='+tipo.tipo+'><strong>  CONSEGNATO</strong></p><p style="font-size: 12px;margin-bottom: 0px;margin-top: 0px;text-align: center;padding-top: 0px;">Tot. Importo <strong>'+o.totale_ordine+"</strong>€</p></div></div></td></tr>")}})),db.ref("ordini_in_consegna/"+uid).orderByChild("id_ordine").on("child_added",(function(o,t){for(a in o=o.val())if("id_ordine"==a){tipo=select_tipo("ordine_in_consegna",parseInt(o.ordine_tipo));var i="no";"false"==stsMua&&(i="yes"),"true"==stsMua&&("Master"==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes")),"yes"==i&&(t_distanza=o.distanza,t_percorso_start=getGPS_distanza(datas.lat_base,datas.lng_base,o.lat,o.lng),t_percorso=getGPS_distanza(o.lat_rider,o.lng_rider,o.lat,o.lng),t_percorso_reale=t_distanza/1e3*t_percorso/(t_percorso_start/1e3),t_percorso_reale=parseFloat(t_percorso_reale).toFixed(0),t_percorso_reale=-t_percorso_reale,t_distanza=-t_distanza,"attend"==o.delivery_accept?(distanzaKM="In attesa di risposta..",misura=""):distanzaKM=o.distanza_google,isNaN(t_percorso)&&"ok"==o.delivery_accept&&(distanzaKM="In attesa posizione Rider..",misura=""),$("#rx_in_consegna").prepend('<tr id="'+o.id_ordine+'" onclick="dettaglio_ordini(this.id,2,0)"><td><div class="col" style="padding-top: 0px;border-style: '+border_style+';margin-bottom: -20px;"><h1 style="color: rgb(0,123,255);border-style: none;border-color: rgba(1,164,225,0);text-align: center;"><button id="notyr-'+o.id_ordine+'"; class="btn btn-primary" type="button" style="font-size: 10px;color: rgb(1,1,1);background-color: rgb(255,164,48);border-width: 1px;border-color: rgb(7,7,7);box-shadow: 0px 0px 7px rgb(62,140,228);"><i class="fa fa-check" style="font-size: 12px;"></i>&nbsp;ID Ordine&nbsp;<strong>'+o.id_ordine+"&nbsp; </strong>del &nbsp;<strong>"+o.data_lavorazione+'</strong></button></h4><h4 class="text-body" style="font-size: 14px;text-align: center;">'+o.nome+" "+o.cognome+'</h4><p id="status-'+o.id_ordine+'";  class="text-center" style="font-size: 12px;background-color: rgba(0,0,0,0);'+tipo.style_oia+'padding-left: 0px;padding-top: 0px;margin-bottom: 0px;margin-top: 0px;"><img width="'+iconpx+'" height=" '+iconpx+' "  src='+tipo.tipo+'><strong> Ordine in  CONSEGNA</strong></p><p style="font-size: 12px;margin-bottom: 0px;margin-top: 0px;text-align: center;padding-top: 0px;">Tot. Importo <strong>'+o.totale_ordine+'</strong>€</p><div id="delivery-'+o.id_ordine+'"; class="slidecontainer"><p id="distanza-'+o.id_ordine+'";>'+distanzaKM+'<input disabled type="range" min="'+t_distanza+'"  max="0" value="'+t_percorso_reale+'" class="slider" ></p></div></div></td></tr>'),t_percorso_reale>distanza_notifica&&"ok"==o.delivery_accept?($("#notyr-"+o.id_ordine).addClass("pulse animated infinite"),$("#notyr-"+o.id_ordine).css("background-color","#3ded11")):$("#notyr-"+o.id_ordine).css("background-color","#fcdb03"))}})),db.ref("ordini_in_consegna/"+uid).on("child_removed",(function(o,t){for(a in val=o.val(),val)"id_ordine"==a&&$("#"+val.id_ordine).remove()})),db.ref("ordini_in_consegna/"+uid).orderByChild("id_ordine").on("child_changed",(function(o,t){for(a in o=o.val())if("delivery"==a){var i=o.status_notifica;if(t_distanza=o.distanza,t_percorso_start=getGPS_distanza(datas.lat_base,datas.lng_base,o.lat,o.lng),t_percorso=getGPS_distanza(o.lat_rider,o.lng_rider,o.lat,o.lng),t_percorso_reale=t_distanza/1e3*t_percorso/(t_percorso_start/1e3),t_percorso_reale=parseFloat(t_percorso_reale).toFixed(0),t_percorso_reale=-t_percorso_reale,t_distanza=-t_distanza,t_percorso_reale>distanza_notifica&&!i){$("#notyr-"+o.id_ordine).addClass("pulse animated infinite"),$("#notyr-"+o.id_ordine).css("background-color","#3ded11"),url="https://dalm596ei.cittacoupon.it",path="/delivery/notify-rider.php?",api_key="8vfhHKD75dk",tipo="300",id_clienti="78sdv%gsd$DFgh",id_utente="rider",send_type="3",id_ordine=o.id_ordine,messaggio="Preparati!! il tuo ordine a domicilio  in arrivo, tra pochi minuti siamo a casa tua. Grazie",times=setTimeout(http_stop_timer,11e3);var e="api_key="+api_key+"&id_clienti="+id_clienti+"&id_utente="+id_utente+"&tipo="+tipo+"&send_type="+send_type+"&id_ordine="+id_ordine,n=url+path+e;app.HttpRequest("get",n,null,null,res_noty)}isNaN(t_percorso)&&"ok"==o.delivery_accept?(distanzaKM="In attesa posizione Rider..",misura=""):distanzaKM=o.distanza_google}$("#delivery-"+o.id_ordine).html("<p>"+distanzaKM+'<input disabled type="range" min="'+t_distanza+'"  max="0"  value="'+t_percorso_reale+'" class="slider" ></p>')})),db.ref("ordini_in_arrivo/"+uid).orderByChild("id_ordine").on("child_added",(function(o,t){for(a in o=o.val())if("id_ordine"==a){array_ordini_in_arrivo.push({id_ordine:o.id_ordine,data_lavorazione:o.data_lavorazione}),data_lavorazione=o.data_lavorazione,data_lavorazione=moment(data_lavorazione,"DD-MM-YYYY HH:mm"),data_adesso=moment(),tempo_residuo=data_lavorazione.diff(data_adesso,"minutes");o.data_lavorazione;if("attend"==o.notifica_ordine){notifica++,tipo=select_tipo("ordine_in_arrivo_read",parseInt(o.ordine_tipo));var i="no";if("false"==stsMua&&(i="yes"),"true"==stsMua&&("Master"==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes")),"yes"==i){if(tipo_ordine_vocale=vocale_tipo(parseInt(o.ordine_tipo)),messaggi_notifica(tipo_ordine_vocale),0==notifica?$("#counter-msg").hide():($("#counter-msg").show(),$("#counter-msg").text(notifica),clearInterval(beep_timer),beep_timer=0,beep_timer=setInterval(start_beep,5e3)),"premium"==tipo_user&&("wifi"==print_tipo_connessione&&"true"==datas.stampa_automatica&&read_header_print(o.id_ordine,"dettaglio","InArrivo"),"bluetooth"==print_tipo_connessione&&"true"==datas.stampa_automatica&&print_bluetooth(o.id_ordine,"dettaglio","InArrivo")),"premium"!=tipo_user&&creditoPunti>0&&notifica<=5&&"wifi"==print_tipo_connessione&&"true"==datas.stampa_automatica&&(net.Connect(print_0[3],print_0[2]),read_header_print(o.id_ordine,"dettaglio","InArrivo"),"bluetooth"==print_tipo_connessione&&"true"==datas.stampa_automatica&&print_bluetooth(o.id_ordine,"dettaglio")),o.delivery_costo&&(o.totale_ordine=parseFloat(o.totale_ordine)+parseFloat(o.delivery_costo)),a=moment(o.data_stimata,"DD-MM-YYYY HH:mm"),b=moment(o.data_lavorazione,"DD-MM-YYYY HH:mm"),ritardo_=b.diff(a,"minutes"),ritardo_>0?ritardo_="Ritardo di "+b.diff(a,"minutes")+" minuti":ritardo_="","Large"==datas.app_layout){o.totale_ordine=parseFloat(o.totale_ordine).toFixed(2);var e='<tr id="'+o.id_ordine+'" onclick="dettaglio_ordini(this.id,1,1)"><td><div class="col" style="text-align:center;padding-top: 10px;border-style: '+border_style+';margin-bottom: -20px;"><button id="noty-'+o.id_ordine+'" class="btn btn-primary pulse" type="button" style="font-size: 12px;color: #000000;margin-bottom: 5px;background-color: #e89607;border-width: 1px;border-color: rgb(7,7,7);box-shadow: 0px 0px 7px rgb(62,140,228);"><img width="'+iconpx+'" height="'+iconpx+'"  src='+tipo.tipo+">&nbsp;&nbsp;<strong>"+o.id_ordine+"</strong>&nbsp;&nbsp;&nbsp;&nbsp;"+o.nome+" "+o.cognome+' </button><div id="status_lavorazione_view-'+o.id_ordine+'"> <p class="text-center" style="font-size: 12px;background-color:'+o.status_lavorazione_style+';color:#ffffff;padding-left: 0px;padding-top: 0px;margin-bottom: 0px;margin-top: 0px;"><span>'+o.status_lavorazione+"  "+ritardo_+"</span><br><span><strong>&nbsp;Ordinato: &nbsp; </strong>"+o.data_stimata+"</span><span>&nbsp;&nbsp;<strong>InConsegna: &nbsp;</strong>"+o.data_lavorazione+'</span></p></div><div id="tempo_residuo-'+o.id_ordine+'"; class="row" style="margin-top: 5px;"><div class="col" style="height: 18px;padding-right: 0px;padding-left: 0px;"><div class="slidecontainer"><input disabled type="range" min="1" max="100" value="'+tempo_residuo+'" class="slider"></div></div><p style="color:#0a81a8;";>'+tempo_residuo+'Min</p></div><p style="font-size: 16px;margin-bottom: 5px;margin-top: -20px;text-align: center;padding-top: 0px;color:#09a5ed">Tot. Importo <strong>'+o.totale_ordine+'</strong>€<span id="pagamento-'+o.id_ordine+'">&nbsp;&nbsp;&nbsp;&nbsp;Pagamento: <strong>'+o.pagamento_stato+"</strong></span></p></td></tr>"}"false"==datas.tipo_visualizzazione?$("#rx_in_arrivo").prepend(e):$("#rx_in_arrivo").append(e),$("#noty-"+o.id_ordine).addClass("pulse animated infinite")}}if("read"==o.notifica_ordine){tipo=select_tipo("ordine_in_arrivo_read",parseInt(o.ordine_tipo));i="no";if("false"==stsMua&&(i="yes"),"true"==stsMua&&("Master"==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes"),tipo.codice_tipo==num_mur&&(i="yes")),"yes"==i){if(0==notifica&&$("#counter-msg").hide(),o.delivery_costo&&(o.totale_ordine=parseFloat(o.totale_ordine)+parseFloat(o.delivery_costo)),a=moment(o.data_stimata,"DD-MM-YYYY HH:mm"),b=moment(o.data_lavorazione,"DD-MM-YYYY HH:mm"),ritardo_=b.diff(a,"minutes"),ritardo_>0?ritardo_="+"+b.diff(a,"minutes")+"min":ritardo_="","Large"==datas.app_layout){o.totale_ordine=parseFloat(o.totale_ordine).toFixed(2);var n='<tr id="'+o.id_ordine+'" onclick="dettaglio_ordini(this.id,1,0)"><td><div class="col" style="text-align:center;padding-top:10px;border-style: '+border_style+';margin-bottom: -20px;"><button id="noty-'+o.id_ordine+'" class="btn btn-primary pulse" type="button" style="font-size: 12px;color: #000000;margin-bottom: 5px;background-color: #ffffff;border-width: 1px;border-color: rgb(7,7,7);box-shadow: 0px 0px 7px rgb(62,140,228);"><img width="'+iconpx+'" height="'+iconpx+'"   src='+tipo.tipo+">&nbsp;&nbsp;<strong>"+o.id_ordine+"</strong>&nbsp;&nbsp;&nbsp;&nbsp;"+o.nome+" "+o.cognome+' </button><div id="status_lavorazione_view-'+o.id_ordine+'"> <p class="text-center" style="font-size: 12px;background-color:'+o.status_lavorazione_style+';color:#ffffff;padding-left: 0px;padding-top: 0px;margin-bottom: 0px;margin-top: 0px;"><span>'+o.status_lavorazione+"  "+ritardo_+"</span><br><span><strong>&nbsp;Ordinato: &nbsp; </strong>"+o.data_stimata+"</span><span>&nbsp;&nbsp;<strong>InConsegna: &nbsp;</strong>"+o.data_lavorazione+'</span></p></div><div id="tempo_residuo-'+o.id_ordine+'"; class="row" style="margin-top: 5px;"><div class="col" style="height: 18px;padding-right: 0px;padding-left: 0px;"><div class="slidecontainer"><input disabled type="range" min="1" max="100" value="'+tempo_residuo+'" class="slider"></div></div><p style="color:#0a81a8;";>'+tempo_residuo+'Min</p></div><p style="font-size: 15px;margin-bottom: 10px;margin-top: -20px;text-align: center;padding-top: 0px;color:#09a5ed">Tot. Importo <strong>'+o.totale_ordine+'</strong>€<span id="pagamento-'+o.id_ordine+'"><br>&nbsp;&nbsp;&nbsp;&nbsp;Pagamento: <strong>'+o.pagamento_stato+"</strong></span></p></td></tr>"}"false"==datas.tipo_visualizzazione?$("#rx_in_arrivo").prepend(n):$("#rx_in_arrivo").append(n)}}}})),db.ref("ordini_in_arrivo/"+uid).on("child_removed",(function(o,t){for(a in val=o.val(),val)"id_ordine"==a&&$("#"+val.id_ordine).remove()})),db.ref("ordini_in_arrivo/"+uid).on("child_changed",(function(o){for(a in o=o.val()){for(aa in"notifica"==o.update&&"notifica_ordine"==a?notifica-=1:0==notifica&&$("#counter-msg").hide(),0==notifica&&($("#counter-msg").hide(),clearInterval(beep_timer),beep_timer=0),$("#counter-msg").text(notifica),array_ordini_in_arrivo)for(ab in arr1=array_ordini_in_arrivo[aa],arr1)o.id_ordine==arr1.id_ordine&&(arr1.data_lavorazione=o.data_lavorazione);time(),a=moment(o.data_stimata,"DD-MM-YYYY HH:mm"),b=moment(o.data_lavorazione,"DD-MM-YYYY HH:mm"),ritardo_=b.diff(a,"minutes"),ritardo_>0?ritardo_="<strong>+"+b.diff(a,"minutes")+"</strong>":ritardo_="","Large"==datas.app_layout&&($("#status_lavorazione_view-"+o.id_ordine).html('<p class="text-center" style="font-size: 12px;background-color:'+o.status_lavorazione_style+';color:#ffffff;padding-left: 0px;padding-top: 0px;margin-bottom: 0px;margin-top: 0px;"><span>'+o.status_lavorazione+"  "+ritardo_+"</span><br><span><strong>&nbsp;Ordinato: &nbsp; </strong>"+o.data_stimata+"</span><span>&nbsp;&nbsp;<strong>InConsegna: &nbsp;</strong>"+o.data_lavorazione+"</span></p>"),$("#pagamento-"+o.id_ordine).html("&nbsp;&nbsp;&nbsp;&nbsp;Pagamento: <strong>"+o.pagamento_stato+"</strong>")),"Compact"==datas.app_layout&&($("#status_lavorazione_view-compact-a-"+o.id_ordine).html('<span class="d-md-flex pulse animated infinite" style="font-size: 14px;color: #e80707;font-weight: bold;">'+ritardo_+"</span>"),$("#status_lavorazione_view-compact-b-"+o.id_ordine).html('<div class="col-sm-12 d-sm-flex align-items-sm-center" style="text-align: left;font-size: 20px;padding-right: 0px;padding-left: 3px;"><span style="font-size: 14px;">Richiesto</span><span style="color: rgb(33,37,41);font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+o.data_stimata+"</span></div>"),$("#status_lavorazione_view-compact-c-"+o.id_ordine).html('<div class="col d-sm-flex align-items-sm-center" style="text-align: left;font-size: 20px;color: #ffffff;padding-right: 0px;padding-left: 3px;"><span style="text-align: left;color: #ffffff;padding-right: 10px;font-size: 14px;font-weight: bold;">Consegna</span><span style="font-size: 14px;">'+o.data_lavorazione+"<br></span></div>"),$("#status_lavorazione_view-compact-c-"+o.id_ordine).css("background-color",o.status_lavorazione_style),$("#status_lavorazione_view-compact-d-"+o.id_ordine).html(o.pagamento_stato)),$("#noty-"+o.id_ordine).removeClass("pulse animated infinite"),$("#noty-"+o.id_ordine).css("background-color","rgb(255,255,255)")}})))):db.goOffline())}function OnConnectionChange(o){connected=o.val(),connected?(app.HideProgressBar(),$("#status").html(online),uid&&!listened&&(listened=!0)):$("#status").html(offline)}app.Script("Firebase/app.js",!0),app.Script("Firebase/database.js",!0),app.Script("Firebase/auth.js",!0),firebase.initializeApp(firebaseConfig),db=firebase.database(),auth=firebase.auth(),db.goOffline(),ConnectFFT(),CreateListeners()}function dettaglio_ordini(o,t,i){if(creditoPunti<valore_punti&&"premium"!=tipo_user&&1==i&&$.confirm({title:"<strong>Credito Insufficiente!!</strong>",content:"per continuare ad usufruire del servizio effettua subito una ricarica",buttons:{Ricarica:function(){return urlpage("Acquista Punti-SMS"),!0},Annulla:function(){return!0}}}),creditoPunti>=valore_punti||"premium"==tipo_user||1!=i){page=t,1==page&&(page_name="Ordine"),2==page&&(page_name="InConsegna"),3==page&&(page_name="Consegnato"),4==page&&(page_name="Annullato"),5==page&&(page_name="Storico");var e=0;db.ref("dettaglio_ordini").child("/"+uid+"/"+o).on("value",(function(i){if(1==++e){i=i.val();for(a in view("dettaglio",o,page_name),i){"ordine_tipo"==a&&(tipo=select_tipo("tipo_dettaglio_ordini",parseInt(i.ordine_tipo))),"delivery_costo"==a&&(delivery_costo=Number(i.delivery_costo));var n='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom:0px;padding-bottom: 2%;border-style: none;"><div class="block-heading" style="padding-top: 0%;padding-bottom: 0%;padding-right: 0px;border-style: '+border_style+'margin-top: 0%;margin-bottom: 1%;height: 100%;"><div class="block-heading" style="padding-top: 0px;padding-bottom: 0px;padding-right: 0px;margin-top: 1%;border-style:solid;border-color: rgba(33,37,41,0);height: 100%;width: 100%;margin-bottom: 1%;"><div id="modal-open-1"><div  class="modal fade" role="dialog" tabindex="-1"id="modal-1" aria-labelledby="modal-label-1"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Lavorazione Ordine</h4><button type="button" class="close" data-dismiss="modal" aria-label="Esci"><span aria-hidden="true"></span></button></div><div class="modal-body">';"0"<=i.ordine_tipo&&(n+='<button id="1" type="button" class="btn btn-lg" style="color:#000000;background-color:#fcec03;width:300px;height:50px;margin-bottom: 6%;border-color:#000000"data-toggle="popover" title="" data-content=""><i class="fa fa-cart-arrow-down"></i>Ordine in Preparazione</button><br>',n+='<button id="3" type="button" class="btn btn-lg" style="color:#000000;background-color:#36ab16;width:300px;height:120px;margin-bottom: 8%;"data-toggle="popover" title="" data-content=""><i class="fa fa-check-circle"></i>Ordine Consegnato</button><br><br><br><br>'),"100"==i.ordine_tipo&&(n+='<button id="2" type="button" class="btn btn-lg" style="color:#000000;background-color:#00a7f5;width:300px;height:80px;margin-bottom: 8%;"data-toggle="popover" title="" data-content=""><i class="fa fa-car"></i>Delivery Start</button><br>'),n+='<button id="0" type="button" class="btn btn-lg" style="color:#000000;background-color:#fc8403;width:300px;hight:30px;margin-bottom: 2%;border-color:#000000"data-toggle="popover" title="" data-content=""><i class="fa fa-exclamation-triangle"></i>Gestione Imprevisti!!</button><br><br></div><div class="modal-footer"><button class="btn" data-dismiss="modal" style="background-color:rgb(44,41,42);color:#ffffff" type="button">Esci</button></div></div></div></div><div id="modal-open-2"><div  class="modal fade" role="dialog" tabindex="-1"id="modal-4" aria-labelledby="modal-label-1"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Gestione Imprevisti</h4><button type="button" class="close" data-dismiss="modal" aria-label="Esci"><span aria-hidden="true"></span></button></div><div class="modal-body"><button id="30" type="button" class="btn btn-lg" style="color:#000000;background-color:#fcec03;width:300px;hight:30px;margin-bottom: 2%;border-color:#000000"data-toggle="popover" title="" data-content=""><i class="fa fa-hourglass"></i>Gestione Ritardi</button><br><button id="31" type="button" class="btn btn-lg" style="color:#000000;background-color:#00a7f5;width:300px;hight:30px;margin-bottom: 2%;"data-toggle="popover" title="" data-content=""><i class="fa fa-times"></i>Annulla Ordini</button><br></div><div class="modal-footer"><button class="btn" data-dismiss="modal" style="background-color:rgb(44,41,42);color:#ffffff" type="button">Esci</button></div></div></div></div><div id="modal-open-3"><div  class="modal fade" role="dialog" tabindex="-1"id="modal-5" aria-labelledby="modal-label-1"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Gestione Ritardi</h4><button type="button" class="close" data-dismiss="modal" aria-label="Esci"><span aria-hidden="true"></span></button></div><div class="modal-body"><button id="40" type="button" class="btn btn-lg" style="color:#000000;background-color:#dbc412;width:300px;hight:30px;margin-bottom: 2%;"data-toggle="popover" title="" data-content="">Ritardo +15 Minuti </button><button id="41" type="button" class="btn btn-lg" style="color:#000000;background-color:#db8712;width:300px;hight:30px;margin-bottom: 2%;"data-toggle="popover" title="" data-content="">Ritardo +30 Minuti </button><button id="42" type="button" class="btn btn-lg" style="color:#000000;background-color:#db5512;width:300px;hight:30px;margin-bottom: 2%;"data-toggle="popover" title="" data-content="">Ritardo +40 Minuti </button><button id="43" type="button" class="btn btn-lg" style="color:#000000;background-color:#e30f67;width:300px;hight:30px;margin-bottom: 2%;"data-toggle="popover" title="" data-content="">Ritardo +50 Minuti </button><br><br></div><div class="modal-footer"><button class="btn" data-dismiss="modal" style="background-color:rgb(44,41,42);color:#ffffff" type="button">Esci</button></div></div></div></div>',n+='<div id="modal-open-5"><div  class="modal fade" role="dialog" tabindex="-1"id="modal-3" aria-labelledby="modal-label-3"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Causale Annullamento</h4><button type="button" class="close" data-dismiss="modal" aria-label="Esci"><span aria-hidden="true"></span></button></div><div class="modal-body"><button id="20" type="button" class="btn btn-lg" style="color:#000000;background-color:#d6b629;font-size:14px;width:300px;hight:30px;margin-bottom: 2%;border-color:#000000"data-toggle="popover" title="" data-content=""><strong>Causale 1)</strong><br>Ordine Annullato!! Prodotto/i non più disponibile/i</button><button id="21" type="button" class="btn btn-lg" style="color:#000000;background-color:#d6c829;font-size:14px;width:300px;hight:30px;margin-bottom: 2%;border-color:#000000"data-toggle="popover" title="" data-content=""><strong>Causale 2)</strong><br>Ordine Annullato!! Fuori zona di consegna</button><button id="22" type="button" class="btn btn-lg" style="color:#000000;background-color:#c8d629;font-size:14px;width:300px;hight:30px;margin-bottom: 2%;border-color:#000000"data-toggle="popover" title="" data-content=""><strong>Causale 3)</strong><br>Ordine Annullato!! Insenso traffico, ritardo eccessivo</button></div><div class="modal-footer"><button class="btn" data-dismiss="modal" style="background-color:rgb(44,41,42);color:#ffffff" type="button">Esci</button></div></div></div></div><button id="lavorazione_ordine" type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-1" order-color: #3b99e0;"><i class="icon ion-android-restaurant flash animated infinite"style="font-size: 22px;"></i><strong>Lavorazione Ordine</strong></button><button id="consegnato" type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-2" order-color: #3b99e0;"><strong>In Consegna..</strong></button></div><div class="block-heading" style="padding-top: 0px;padding-bottom: 0px;padding-right: 0px;margin-top: 1%; border-style: solid;border-color: rgba(33,37,41,0);height: 100%;width: 100%;margin-bottom: 1%;"></div><p><strong>Id Order: '+i.id_ordine+"</strong></p><p>Consegna stimata : "+i.data_lavorazione+"</p><p>Pagamento: <strong>"+i.pagamento_tipo+"</strong></br>Status:  <strong>"+i.pagamento_stato+'</strong></p><p style="font-size:28px'+tipo.style_oia+'">',i.ordine_tipo,n+='<img  width="'+iconpx+'" height=" '+iconpx+' " src='+tipo.tipo+"></p>",i.nome,i.cognome,n+="<p>","***"!=i.indirizzo&&(n+=i.indirizzo+"&nbsp;&nbsp;"),"***"!=i.cap&&(n+=i.cap+"&nbsp;"),"***"!=i.paese&&(n+=i.paese+"&nbsp;"),n+="</p>","***"!=i.campanello&&i.campanello&&(n+="<p>Nome Citofono : "+i.campanello+"</p>"),"***"!=i.tavolo&&i.tavolo&&(n+="<p>Tavolo : "+i.tavolo+"</p>"),"***"!=i.ombrellone&&i.ombrellone&&(n+="<p>Ombrellone : <strong>"+i.ombrellone+"</strong></p>"),"***"!=i.telefono&&(n+="<p>Tel : "+i.telefono+"</p>"),"***"!=i.email&&(n+="<p>Email: "+i.email+"</p>"),"1"==i.ordine_tipo&&(n+='<button id="google_map" type="button" class="btn" color: #34a8eb;"><img  src="Img/map.png" style="width:35px;height:35px"><strong>Vedi Destinazione</strong></button>'),n+='<p style="text-align:center;background-color: #23a9f7;padding-left: 8px;margin-bottom: 5px;font-size: 14px;color:#ffffff">Tipo Pagamento : &nbsp;'+i.pagamento_tipo+"</p>","***"!=i.note&&(n+='<p style="background-color: #fcda00;text-align: center;padding-left: 8px;margin-bottom: 0px;font-size: 14px;">Note:&nbsp;'+i.note+"</p></div></div>"),$("#doia-header").html(n),page>1?($("#lavorazione_ordine").hide(),$("#consegnato").show()):("notifica_ordine"==a&&"attend"==i.notifica_ordine&&("2"==i.ordine_tipo&&db.ref("credito/"+uid).update({punti:creditoPunti-valore_punti_ordini_tavolo}),"2"!=i.ordine_tipo&&db.ref("credito/"+uid).update({punti:creditoPunti-valore_punti}),db.ref("ordini_in_arrivo/"+uid+"/"+o).update({update:"notifica",notifica_ordine:"read"}),db.ref("dettaglio_ordini/"+uid+"/"+o).update({notifica_ordine:"read"})),$("#lavorazione_ordine").show(),$("#consegnato").hide()),$("#doia-header").show(),$("#0").click((function(){$("#modal-1").modal("hide"),$("#modal-4").modal("show")})),$("#1").click((function(){$(this).prop("id");1==confirm("Ordine in Preparazione..")&&($("#modal-1").modal("hide"),notifiche(i,"0"))})),$("#2").click((function(){$(this).prop("id");1==confirm("Inviare Ordine in Consegna?")&&($("#modal-1").modal("hide"),notifiche(i,"6"))})),$("#10").click((function(){$(this).prop("id");1==confirm("Consegnare Ordine?")&&($("#modal-2").modal("hide"),notifiche(i,"7"))})),$("#3").click((function(){$(this).prop("id");1==confirm("Consegnare Ordine?")&&($("#modal-1").modal("hide"),notifiche(i,"8"))})),$("#30").click((function(){$("#modal-4").modal("hide"),$("#modal-5").modal("show")})),$("#31").click((function(){$("#modal-4").modal("hide"),$("#modal-3").modal("show")})),$("#20").click((function(){$("#modal-3").modal("hide");$(this).prop("id");1==confirm("Stai inviando annullamento con Causale 1\n Vuoi Procedere?")&&($("#modal-4").modal("hide"),notifiche(i,"10"))})),$("#21").click((function(){$("#modal-3").modal("hide");$(this).prop("id");1==confirm("Stai inviando annullamento con Causale 2\n Vuoi Procedere?")&&($("#modal-4").modal("hide"),notifiche(i,"11"))})),$("#22").click((function(){$("#modal-3").modal("hide");$(this).prop("id");1==confirm("Stai inviando annullamento con Causale 3\n Vuoi Procedere?")&&($("#modal-4").modal("hide"),notifiche(i,"12"))})),$("#40").click((function(){$(this).prop("id");1==confirm("Conferma Ritardo 15min")&&($("#modal-5").modal("hide"),notifiche(i,"2"))})),$("#41").click((function(){$(this).prop("id");1==confirm("Conferma Ritardo 30min")&&($("#modal-5").modal("hide"),notifiche(i,"3"))})),$("#42").click((function(){$(this).prop("id");1==confirm("Conferma Ritardo 40min")&&($("#modal-5").modal("hide"),notifiche(i,"4"))})),$("#43").click((function(){$(this).prop("id");1==confirm("Conferma Ritardo 50min")&&($("#modal-5").modal("hide"),notifiche(i,"5"))})),$("#google_map").click((function(){geo(i.lat,i.lng)}))}dettaglio_ordini_footer(o,t,delivery_costo)}}))}}function dettaglio_ordini_footer(o,t,i){db.ref("dettaglio_ordini/"+uid+"/"+o+"/ordine").on("value",(function(o){(function o(t){for(a in t)if(a=a.toString(16),"object"==typeof t[a]){if(sal=t[a],isNaN(a))if("aggiunte"==a){var i='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize"style="margin-bottom: 8px;margin-top: 8px;text-align: center;background-color: #3c99e02e;margin-bottom: 12px;margin-top: 4px;font-size: 20px;color: #f95a00;"><strong>'+titolo_prodotto+'</strong></div></div></div><div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 8px;margin-top: 8px;text-align: center;background-color: #3c99e02e;font-size:18px">'+descrizione_prodotto+'</p></div></div></div><div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 8px;margin-top: 8px;text-align: center;background-color: #3c99e02e;">'+qta_prodotto+" x "+prezzo_prodotto+"€  = <strong>"+qta_prodotto*prezzo_prodotto+"€</strong></p></div></div></div>";$("#doia-body").append(i),$("#doia-body").show()}else{var e='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom:0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col"><h3 class="text-capitalize" style="font-size: 20px;border-style: none;border-top: 1px none rgb(0,0,0);border-right-width:0px;border-right-color: rgb(251,253,255);border-bottom: 1px none rgb(0,0,0);border-left-color: rgb(255,255,255);color:rgb(59,153,224);text-align: center;box-shadow: 0px 0px 9px;padding: 6px;padding-bottom: 6px;"><i class="fa fa-star-o"></i><strong>&nbsp;'+a+"</strong></h3></div></div></div>";$("#doia-body").append(e)}o(sal)}else if("aggiunte_nome"==a||"aggiunte_prezzo"==a){if("aggiunte_nome"==a&&(aggiunte_nome=t.aggiunte_nome),"aggiunte_prezzo"==a&&""!=t.aggiunte_prezzo){aggiunte_prezzo=Number(t.aggiunte_prezzo),sub_totale_aggiunte+=aggiunte_prezzo;var n='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 8px;margin-top: 8px;text-align: center;background-color: rgba(35,210,19,0.15);"><strong>+ '+aggiunte_nome+"</strong>  Prezzo : <strong>"+aggiunte_prezzo+"€</strong></strong></p></div></div></div>";$("#doia-body").append(n)}}else"titolo"==a&&(titolo_prodotto=t.titolo),"descrizione"==a&&(descrizione_prodotto=t.descrizione),"qta"==a&&(qta_prodotto=t.qta),"prezzo"==a&&(prezzo_prodotto=Number(t.prezzo),sub_totale_prodotti+=qta_prodotto*prezzo_prodotto)})(o=o.val()),totale=i+costo_pay+sconto+sub_totale_prodotti+sub_totale_aggiunte+totale,sub_totale_prodotti=parseFloat(sub_totale_prodotti).toFixed(2),totale=parseFloat(totale).toFixed(2);var t='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: '+margine_inferiore_dettaglio_footer+';padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #f09711;">Totale Ordine : <strong>'+totale+"€</strong></p></div></div></div>",e='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #f7b552;">Totale Prodotti : <strong>'+sub_totale_prodotti+"€</strong></p></div></div></div>",n='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #f5b85d;">Totale Aggiunte : <strong>'+sub_totale_aggiunte+"€</strong></p></div></div></div>",r='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #fac16b;">Delivery : <strong>'+i+"€</strong></p></div></div></div>",d='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #f7c67c;">Sconto : <strong>'+sconto+"€</strong></p></div></div></div>",s='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #facd89;">CostoPagamento : <strong>'+costo_pay+"€</strong></p></div></div></div>";sub_totale_prodotti>0&&$("#doia-body").append(e),sub_totale_aggiunte>0&&$("#doia-body").append(n),i>0&&$("#doia-body").append(r),sconto>0&&$("#doia-body").append(d),costo_pay>0&&$("#doia-body").append(s),totale>0&&$("#doia-body").append(t),$("#doia-body").show(),totale=i=costo_pay=sconto=sub_totale_prodotti=sub_totale_aggiunte=0}))}function dettaglio_storico(o,t){page=t,1==page&&(page_name="Ordine"),2==page&&(page_name="InConsegna"),3==page&&(page_name="Consegnato"),4==page&&(page_name="Annullato"),5==page&&(page_name="Storico");var i=0;db.ref("dettaglio_storico").child("/"+uid+"/"+o).on("value",(function(e){e=e.val();for(a in view("dettaglio_storico",o,page_name),e){"ordine_tipo"==a&&(tipo=select_tipo("dettaglio_ordine_storico",parseInt(e.ordine_tipo))),"delivery_costo"==a&&(i=Number(e.delivery_costo));var n='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom:0px;padding-bottom: 0%;border-style: none;"><div class="block-heading" style="padding-top: 0%;padding-bottom: 2%;padding-right: 0px;border-style: '+border_style+';margin-top: 0%;margin-bottom: 1%;height: 100%;"><div class="block-heading" style="padding-top: 0px;padding-bottom: 0px;padding-right: 0px;margin-top: 1%;border-style:solid;border-color: rgba(33,37,41,0);height: 100%;width: 100%;margin-bottom: 1%;"><button id="lavorazione_ordine" type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-1" order-color: #3b99e0;"><i class="icon ion-android-restaurant"style="font-size: 22px;"></i><strong>Storico Ordine</strong></button></div><div class="block-heading" style="padding-top: 0px;padding-bottom: 0px;padding-right: 0px;margin-top: 1%; border-style: solid;border-color: rgba(33,37,41,0);height: 100%;width: 100%;margin-bottom: 1%;"><p><strong>Id Order: '+e.id_ordine+'</strong></p><p style="background-color:#ffffff;text-align: center;padding-left: 0px;color: rgb(228,65,29);height: 100%;border-style: none;font-size: 14px;"><strong><em>&nbsp;</em></strong><i class="icon ion-clock" style="font-size: 17px;"></i><em>&nbsp;Data Ordine:&nbsp;&nbsp;</em><strong><em>'+e.data_ordine+'</em></strong></p><p style="background-color: rgba(0,0,0,0);text-align: center;padding-left: 0px;color: rgb(228,65,29);height: 100%;border-style: none;font-size: 14px;"><strong><em>&nbsp;</em></strong><i class="icon ion-clock" style="font-size: 17px;"></i><em>&nbsp;DataConsegna: &nbsp;&nbsp;</em><strong><em>'+e.data_stimata+"</em></strong></p><p>Pagamento: <strong>"+e.pagamento_tipo+"</strong><br>Status:  <strong>"+e.pagamento_stato+'</strong></p></div><p style="font-size:28px'+tipo.style_oia+'"><img width="40px" height="40px" src='+tipo.tipo+"><strong>"+page_name+'</strong></p><h2 class="text-info">'+e.nome+"  "+e.cognome+"</h2><p>"+e.indirizzo+"&nbsp;&nbsp;"+e.cap+"&nbsp;"+e.paese+"&nbsp;</p>";n+="<p>","***"!=e.indirizzo&&(n+=e.indirizzo+"&nbsp;&nbsp;"),"***"!=e.cap&&(n+=e.cap+"&nbsp;"),"***"!=e.paese&&(n+=e.paese+"&nbsp;"),n+="</p>","***"!=e.campanello&&e.campanello&&(n+="<p>Nome Citofono : "+e.campanello+"</p>"),"***"!=e.tavolo&&e.tavolo&&(n+="<p>Tavolo : "+e.tavolo+"</p>"),"***"!=e.ombrellone&&e.ombrellone&&(n+="<p>Ombrellone : <strong>"+e.ombrellone+"</strong></p>"),"***"!=e.telefono&&(n+="<p>Tel : "+e.telefono+"</p>"),"***"!=e.email&&(n+="<p>Email: "+e.email+"</p>"),"1"==e.ordine_tipo&&(n+='<button type="button" class="btn" color: #34a8eb;"><img  src="Img/map.png" style="width:35px;height:35px"><strong>Vedi Mappa</strong></button>'),n+='<p style="text-align:center;background-color: #23a9f7;padding-left: 8px;margin-bottom: 5px;font-size: 14px;color:#ffffff">Tipo Pagamento : &nbsp;'+e.pagamento_tipo+"</p>","***"!=e.note&&(n+='<p style="background-color: #fcda00;text-align: center;padding-left: 8px;margin-bottom: 0px;font-size: 14px;">Note:&nbsp;'+e.note+"</p></div></div>"),$("#doia-header").html(n),$("#doia-header").show()}dettaglio_ordini_storico_footer(o,t,i)}))}function dettaglio_ordini_storico_footer(o,t,i){db.ref("dettaglio_storico").child("/"+uid+"/"+o+"/ordine").on("value",(function(o){(function o(t){for(a in t)if(a=a.toString(16),"object"==typeof t[a]){if(sal=t[a],isNaN(a))if("aggiunte"==a){var i='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize"style="margin-bottom: 8px;margin-top: 8px;text-align: center;background-color: #3c99e02e;margin-bottom: 12px;margin-top: 4px;font-size: 20px;color: #f95a00;"><strong>'+titolo_prodotto+'</strong></div></div></div><div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 8px;margin-top: 8px;text-align: center;background-color: #3c99e02e;font-size:18px">'+descrizione_prodotto+'</p></div></div></div><div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 8px;margin-top: 8px;text-align: center;background-color: #3c99e02e;">'+qta_prodotto+" x "+prezzo_prodotto+"€  = <strong>"+qta_prodotto*prezzo_prodotto+"€</strong></p></div></div></div>";$("#doia-body").append(i),$("#doia-body").show()}else{var e='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom:0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col"><h3 class="text-capitalize" style="font-size: 20px;border-style: none;border-top: 1px none rgb(0,0,0);border-right-width:0px;border-right-color: rgb(251,253,255);border-bottom: 1px none rgb(0,0,0);border-left-color: rgb(255,255,255);color:rgb(59,153,224);text-align: center;box-shadow: 0px 0px 9px;padding: 6px;padding-bottom: 6px;"><i class="fa fa-star-o"></i><strong>&nbsp;'+a+"</strong></h3></div></div></div>";$("#doia-body").append(e)}o(sal)}else if("aggiunte_nome"==a||"aggiunte_prezzo"==a){if("aggiunte_nome"==a&&(aggiunte_nome=t.aggiunte_nome),"aggiunte_prezzo"==a&&""!=t.aggiunte_prezzo){aggiunte_prezzo=Number(t.aggiunte_prezzo),sub_totale_aggiunte+=aggiunte_prezzo;var n='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 8px;margin-top: 8px;text-align: center;background-color: rgba(35,210,19,0.15);"><strong>+ '+aggiunte_nome+"</strong>  Prezzo : <strong>"+aggiunte_prezzo+"€</strong></strong></p></div></div></div>";$("#doia-body").append(n)}}else"titolo"==a&&(titolo_prodotto=t.titolo),"descrizione"==a&&(descrizione_prodotto=t.descrizione),"qta"==a&&(qta_prodotto=t.qta),"prezzo"==a&&(prezzo_prodotto=Number(t.prezzo),sub_totale_prodotti+=qta_prodotto*prezzo_prodotto)})(o=o.val()),totale=i+costo_pay+sconto+sub_totale_prodotti+sub_totale_aggiunte+totale,sub_totale_prodotti=parseFloat(sub_totale_prodotti).toFixed(2),totale=parseFloat(totale).toFixed(2);var t='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #f09711;">Totale Ordine : <strong>'+totale+"€</strong></p></div></div></div>",e='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #f7b552;">Totale Prodotti : <strong>'+sub_totale_prodotti+"€</strong></p></div></div></div>",n='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #f5b85d;">Totale Aggiunte : <strong>'+sub_totale_aggiunte+"€</strong></p></div></div></div>",r='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #fac16b;">Delivery : <strong>'+i+"€</strong></p></div></div></div>",d='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #f7c67c;">Sconto : <strong>'+sconto+"€</strong></p></div></div></div>",s='<div class="col-sm-6 col-lg-4" style="width: 100%;max-width: 100%;margin-top: 0;height: 100%;max-height: 100%;margin-bottom: 0px;padding-bottom: 0%;border-style: none;"><div class="row justify-content-center"><div class="col" style="border-color: rgb(72,156,225);"><p class="text-capitalize" style="margin-bottom: 1px;margin-top: 1px;text-align: center;background-color: #facd89;">CostoPagamento : <strong>'+costo_pay+"€</strong></p></div></div></div>";sub_totale_prodotti>0&&$("#doia-body").append(e),sub_totale_aggiunte>0&&$("#doia-body").append(n),i>0&&$("#doia-body").append(r),sconto>0&&$("#doia-body").append(d),costo_pay>0&&$("#doia-body").append(s),totale>0&&$("#doia-body").append(t),$("#doia-body").show()})),totale=i=costo_pay=sconto=sub_totale_prodotti=sub_totale_aggiunte=0}function riepilogo(o,t){data_print_wifi=o,riepilogo_asporto=0,riepilogo_costo_asporto=0,riepilogo_domicilio=0,riepilogo_costo_domicilio=0,riepilogo_altavolo=0,riepilogo_costo_altavolo=0,riepilogo_prodotti=0,riepilogo_costo_prodotti=0,riepilogo_ombrellone=0,riepilogo_costo_ombrellone=0,riepilogo_costo_totale=0,riepilogo_delivery=0,riepilogo_costo_delivery=0,riepilogo_annullato=0,riepilogo_costo_annullato=0,ll=0,r=!1,db.ref("ordini_in_consegna").child(uid).once("value",(function(o){o=o.val(),(is_status_in_consegna=o?Object.keys(o).length:0)>0&&$.confirm({title:"<strong>Ordini in Consegna</strong>",content:"Ho trovato <br><strong>"+is_status_in_consegna+" ordini da chiudere.</strong><br>Chiudere tutto?",buttons:{SI:function(){for(sc in o)keyd[ll]=sc,db.ref("ordini_consegnato/"+uid).update(o).then(OnSuccessSend).catch(OnFailedSend),db.ref("ordini_in_consegna/"+uid+"/"+sc).remove().then(OnSuccessSend).catch(OnFailedSend),ll++,view("chiusura_cassa");ll=0,db.ref("dettaglio_ordini").child(uid).once("value",(function(o){for(so in o=o.val())keyd[ll]==so&&(console.log("2 storico update ************** id ordine: "+so+"      "),db.ref("dettaglio_storico/"+uid+"/"+so).update(o[so]).then(OnSuccessSend).catch(OnFailedSend),db.ref("dettaglio_ordini/"+uid+"/"+so).remove().then(OnSuccessSend).catch(OnFailedSend),ll++)}))},NO:function(){}}})})),db.ref("ordini_in_arrivo").child(uid).once("value",(function(o){o=o.val(),(is_status_in_arrivo=o?Object.keys(o).length:0)>0&&$.confirm({title:"<strong>Ordini in Arrivo</strong>",content:"Ho trovato <br><strong>"+is_status_in_arrivo+" ordini da chiudere.</strong><br> Chiudere tutto?",buttons:{SI:function(){for(sc in o)keyd[ll]=sc,db.ref("ordini_consegnato/"+uid).update(o).then(OnSuccessSend).catch(OnFailedSend),db.ref("ordini_in_arrivo/"+uid+"/"+sc).remove().then(OnSuccessSend).catch(OnFailedSend),ll++,view("chiusura_cassa");ll=0,db.ref("dettaglio_ordini").child(uid).once("value",(function(o){for(so in o=o.val())keyd[ll]==so&&(db.ref("dettaglio_storico/"+uid+"/"+so).update(o[so]).then(OnSuccessSend).catch(OnFailedSend),db.ref("dettaglio_ordini/"+uid+"/"+so).remove().then(OnSuccessSend).catch(OnFailedSend),ll++)}))},NO:function(){}}})})),db.ref("ordini_consegnato").child(uid).orderByChild("data_ordine").startAt(o+" 00:00:00").endAt(o+" 23:59:59").once("value",(function(i){for(dd in i=i.val()){var e=i[dd];for(dd1 in e)"ordine_tipo"==dd1&&("0"==e[dd1]&&(riepilogo_asporto++,riepilogo_costo_asporto+=Number(e.totale_ordine),riepilogo_costo_totale+=Number(e.totale_ordine)),"1"==e[dd1]&&(riepilogo_domicilio++,riepilogo_costo_domicilio+=Number(e.totale_ordine),riepilogo_costo_totale+=Number(e.totale_ordine),riepilogo_delivery++,riepilogo_costo_delivery+=Number(e.delivery_costo),riepilogo_costo_totale+=Number(e.delivery_costo)),"2"==e[dd1]&&(riepilogo_altavolo++,riepilogo_costo_altavolo+=Number(e.totale_ordine),riepilogo_costo_totale+=Number(e.totale_ordine)),"3"==e[dd1]&&(riepilogo_prodotti++,riepilogo_costo_prodotti+=Number(e.totale_ordine),riepilogo_costo_totale+=Number(e.totale_ordine)),"4"==e[dd1]&&(riepilogo_ombrellone++,riepilogo_costo_ombrellone+=Number(e.totale_ordine),riepilogo_costo_totale+=Number(e.totale_ordine)))}riepilogo_costo_asporto=parseFloat(riepilogo_costo_asporto).toFixed(2),riepilogo_costo_domicilio=parseFloat(riepilogo_costo_domicilio).toFixed(2),riepilogo_costo_altavolo=parseFloat(riepilogo_costo_altavolo).toFixed(2),riepilogo_costo_prodotti=parseFloat(riepilogo_costo_prodotti).toFixed(2),riepilogo_costo_ombrellone=parseFloat(riepilogo_costo_ombrellone).toFixed(2),riepilogo_costo_delivery=parseFloat(riepilogo_costo_delivery).toFixed(2),riepilogo_costo_altavolo=parseFloat(riepilogo_costo_altavolo).toFixed(2),"stampa_chiusura"==t&&("bluetooth"==print_tipo_connessione&&(bt.SetDataMode("Text"),bt.Write("Chiusura Cassa del "+o+"\n"),bt.Write("------------------------------\n"),bt.Write(" Qta    Transazione    Importo\n"),bt.Write("------------------------------\n"),riepilogo_asporto>0&&bt.Write("  "+riepilogo_asporto+"      Asporto      "+riepilogo_costo_asporto+"E\n"),riepilogo_domicilio>0&&bt.Write("  "+riepilogo_domicilio+"      Domicilio    "+riepilogo_costo_domicilio+"E\n"),riepilogo_altavolo>0&&bt.Write("  "+riepilogo_altavolo+"      AlTavolo     "+riepilogo_costo_altavolo+"E\n"),riepilogo_prodotti>0&&bt.Write("  "+riepilogo_prodotti+"      Prodotti     "+riepilogo_costo_prodotti+"E\n"),riepilogo_ombrellone>0&&bt.Write("  "+riepilogo_ombrellone+"      Ombrellone   "+riepilogo_costo_ombrellone+"E\n"),riepilogo_delivery>0&&bt.Write("  "+riepilogo_delivery+"      Servizi      "+riepilogo_costo_delivery+"E\n")),"stampa_chiusura"==t&&"wifi"==print_tipo_connessione&&net.SetOnConnect(net_OnConnect_chiusura))})),db.ref("ordini_annullato").child(uid).orderByChild("data_ordine").startAt(o+" 00:00:00").endAt(o+" 23:59:59").once("value",(function(o){for(dd in o=o.val()){var i=o[dd];for(dd1 in i)"totale_ordine"==dd1&&(riepilogo_annullato++,riepilogo_costo_annullato+=Number(i.totale_ordine))}riepilogo_costo_annullato=parseFloat(riepilogo_costo_annullato).toFixed(2),riepilogo_costo_totale=parseFloat(riepilogo_costo_totale).toFixed(2),"stampa_chiusura"==t&&("bluetooth"==print_tipo_connessione&&(riepilogo_annullato>0&&bt.Write("  "+riepilogo_annullato+"       Annullati   "+riepilogo_costo_annullato+"E\n"),riepilogo_costo_totale>0&&(bt.Write("\n"),bt.Write("            Totale     "+riepilogo_costo_totale+"E\n"),bt.Write("\n\n\n\n\n"))),"stampa_chiusura"==t&&"wifi"==print_tipo_connessione&&net.Connect(print_0[3],print_0[2]))}));var i="";datain=encode_formatta_data_html(o),i+='<div class="container"><h4>Chiusura CASSA del <strong>'+o+'</strong></h4><p style="font-size:12px;">Cambia data chiusura <input type="date" value="'+datain+'" onchange="cambia_chiusura_data(1,this.value)" id="chiusura_cassa" name="Data  chiusura"></p><table class="table"><thead><tr><th>Q.tà</th><th>Transazione</th><th>Importo</th></tr></thead><tbody>',riepilogo_asporto>0&&(i+="<tr><td>"+riepilogo_asporto+"</td><td>ASPORTO</td><td>"+riepilogo_costo_asporto+"€</td></tr>"),riepilogo_domicilio>0&&(i+="<tr><td>"+riepilogo_domicilio+"</td><td>DOMICILIO</td><td>"+riepilogo_costo_domicilio+"€</td></tr>"),riepilogo_altavolo>0&&(i+="<tr><td>"+riepilogo_altavolo+"</td><td>AL TAVOLO</td><td>"+riepilogo_costo_altavolo+"€</td></tr>"),riepilogo_prodotti>0&&(i+="<tr><td>"+riepilogo_prodotti+"</td><td>PRODOTTI</td><td>"+riepilogo_costo_prodotti+"€</td></tr>"),riepilogo_ombrellone>0&&(i+="<tr><td>"+riepilogo_ombrellone+"</td><td>OMBRELLONE</td><td>"+riepilogo_costo_ombrellone+"€</td></tr>"),riepilogo_delivery>0&&(i+="<tr><td>"+riepilogo_delivery+"</td><td>SERVIZI</td><td>"+riepilogo_costo_delivery+"€</td></tr>"),riepilogo_annullato>0&&(i+="<tr><td>"+riepilogo_annullato+'</td><td style="color:red"><strong>ORDINI ANNULLATI</strong></td><td style="color:red"><strong>'+riepilogo_costo_annullato+"€</strong></td></tr>"),riepilogo_costo_totale>0&&(i+='<tr><td></td><td style="color:green"><strong>TOTALE</strong></td><td style="color:green"><strong>'+riepilogo_costo_totale+"€</strong></td></tr>");i+="</tbody></table></div>",$("#rx_chiusura_cassa").html(i)}function net_OnConnect_chiusura(o){o?(app.ShowPopup("Stampa in Corso.."),close_print()):alert("Stampante OffLine  ")}function sns_OnChange(o){}function close_print(){dataprint=encoder.initialize().line("            Chiusura Cassa del "+data_print_wifi).line("------------------------------").line("    Qta    Transazione    Importo").line("------------------------------").line("     "+riepilogo_asporto+"      Asporto      "+riepilogo_costo_asporto+"$").line("     "+riepilogo_domicilio+"      Domicilio    "+riepilogo_costo_domicilio+"$").line("     "+riepilogo_altavolo+"      AlTavolo     "+riepilogo_costo_altavolo+"$").line("     "+riepilogo_prodotti+"      Prodotti     "+riepilogo_costo_prodotti+"$").line("     "+riepilogo_ombrellone+"      Ombrellone   "+riepilogo_costo_ombrellone+"$").line("     "+riepilogo_delivery+"      Servizi      "+riepilogo_costo_delivery+"$").encode(),net.SendBytes(dataprint),riepilogo_annullato>0&&(dataprint=encoder.initialize().line("  "+riepilogo_annullato+"       Annullati   "+riepilogo_costo_annullato+"$").encode(),net.SendBytes(dataprint)),riepilogo_costo_totale>0&&(dataprint=encoder.initialize().line().line("            Totale     "+riepilogo_costo_totale+"$").encode(),net.SendBytes(dataprint)),dataprint=encoder.initialize().line().line().line().line().line().line().cut("full").encode(),net.SendBytes(dataprint),net.SetOnConnect(net_OnConnect)}function res_noty(o,t){switch(clearTimeout(times),"true"==o?(app.HideProgress(),alert("Errore invio, prego riprovare.")):"300"==t||"100"==t||"101"==t||"102"==t||"103"==t||"104"==t||"105"==t||"error"==t?console.log("reply: "+t):t="error",t){case"300":db.ref("ordini_in_consegna/"+uid+"/"+id_ordine).update({status_notifica:"ok-300"}).then(OnSuccessSend).catch(OnFailedSend);break;case"100":alert("Attenzione!! EMAIL non inviata. Contattare il centro assistenza CittaCoupon."),db.ref("ordini_in_consegna/"+uid+"/"+id_ordine).update({status_notifica:"error-100"}).then(OnSuccessSend).catch(OnFailedSend);break;case"101":alert("Attenzione!! errore invio SMS #000. Contattare il centro assistenza CittaCoupon."),db.ref("ordini_in_consegna/"+uid+"/"+id_ordine).update({status_notifica:"error-101"}).then(OnSuccessSend).catch(OnFailedSend);break;case"102":alert("Attenzione!! Errore invio Email e Sms. Contattare il centro assistenza CittaCoupon."),db.ref("ordini_in_consegna/"+uid+"/"+id_ordine).update({status_notifica:"error-102"}).then(OnSuccessSend).catch(OnFailedSend);break;case"103":alert("Attenzione!! SMS non inviato, numero non valido"),db.ref("ordini_in_consegna/"+uid+"/"+id_ordine).update({status_notifica:"error-103"}).then(OnSuccessSend).catch(OnFailedSend);break;case"104":alert("Attenzione!! Credito SMS insufficiente , effettuare una una ricarica. Grazie."),db.ref("ordini_in_consegna/"+uid+"/"+id_ordine).update({status_notifica:"error-104"}).then(OnSuccessSend).catch(OnFailedSend);break;case"105":alert("errore invio per caratteri >160"),db.ref("ordini_in_consegna/"+uid+"/"+id_ordine).update({status_notifica:"error-105"}).then(OnSuccessSend).catch(OnFailedSend);break;case"error":db.ref("ordini_in_consegna/"+uid+"/"+id_ordine).update({status_notifica:"error #001"}).then(OnSuccessSend).catch(OnFailedSend),alert("Errore invio!! Prego riprovare. #001")}}app.Script("QRCode.js",!0),app.LoadScript("db_init.js"),sns=app.CreateSensor("Light"),sns.SetOnChange(sns_OnChange),sns.Start(),sns.PrevLvl=0;
